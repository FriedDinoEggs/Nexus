(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();let u=null;const p=document.getElementById("googleLoginBtn"),g=document.getElementById("clientIdInput"),y=document.getElementById("statusBar");g.value="683407170565-8pd1tii0gc8bdem3nib1848a2poqqtkf.apps.googleusercontent.com";const k=document.getElementById("statusText"),B=document.getElementById("codeSection"),l=document.getElementById("authCode"),i=document.getElementById("copyBtn"),h=document.getElementById("backendLoginBtn"),E=document.getElementById("tokenSection"),m=document.getElementById("accessToken"),f=document.getElementById("refreshToken");function r(e,t){y.className="status "+e,k.textContent=t}function I(e){if(console.log("Google Response:",e),e.error){r("error",`發生錯誤: ${e.error}`);return}e.code&&(B.style.display="block",l.textContent=e.code,r("success","成功獲取 Authorization Code！"))}p.addEventListener("click",()=>{const e=g.value.trim();if(!e){alert("請先輸入 Google Client ID");return}if(typeof google>"u"){alert("Google GIS SDK 尚未載入，請稍候或檢查網路連線");return}try{u=google.accounts.oauth2.initCodeClient({client_id:e,scope:"openid profile email",ux_mode:"popup",callback:I}),r("pending","正在開啟 Google 授權視窗..."),u.requestCode()}catch(t){console.error("Initialization Error:",t),r("error",`初始化失敗: ${t.message}`)}});i.addEventListener("click",()=>{const e=l.textContent;navigator.clipboard.writeText(e).then(()=>{const t=i.textContent;i.textContent="✅ 已複製！",setTimeout(()=>{i.textContent=t},2e3)})});function a(e,t){const n=e.textContent;!n||n==="N/A"||navigator.clipboard.writeText(n).then(()=>{const s=e.parentElement,o=s.style.background;s.style.background="rgba(255, 255, 255, 0.2)",setTimeout(()=>{s.style.background=o},200)})}document.getElementById("copyCodeBlock").addEventListener("click",function(){a(l)});document.getElementById("accessTokenBlock").addEventListener("click",function(){a(m)});document.getElementById("refreshTokenBlock").addEventListener("click",function(){a(f)});h.addEventListener("click",async()=>{const e=l.textContent;if(e){r("pending","正在嘗試登入後端...");try{const t=await fetch("/api/v1/users/login/google/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})}),n=await t.json();t.ok?(console.log("Backend Login Success:",n),r("success","後端登入成功！"),E.style.display="block",m.textContent=n.access_token||n.access||"N/A",f.textContent=n.refresh_token||n.refresh||"N/A",alert("登入成功！Token 已顯示在下方，點擊區塊即可複製。")):(console.error("Backend Login Failed:",n),r("error",`後端登入失敗: ${n.detail||t.statusText}`))}catch(t){console.error("Network Error:",t),r("error",`連線失敗: ${t.message}`)}}});
